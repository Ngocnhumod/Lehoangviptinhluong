<!DOCTYPE html><html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ch·∫•m c√¥ng ‚Äì C·∫•p ƒë√¥ng c√°</title>
  <style>
    :root{
      --bg:#0b1020; --card:#121a2f; --muted:#94a3b8; --txt:#e6edf7; --acc:#22d3ee; --ok:#4ade80; --warn:#f59e0b; --danger:#ef4444; --radius:14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font:15px/1.45 system-ui,Segoe UI,Roboto,Inter,Arial;background:var(--bg);color:var(--txt)}
    .wrap{max-width:980px;margin-inline:auto;padding:14px}
    h1{font-size:22px;margin:8px 0 12px}
    .card{background:linear-gradient(180deg,#141c33,#0f172a);border:1px solid #1f2a44;border-radius:var(--radius);padding:14px;box-shadow:0 8px 24px rgba(0,0,0,.25)}
    .grid{display:grid;gap:10px}
    @media (min-width:720px){.grid{grid-template-columns:repeat(12,1fr)}}
    label{font-weight:600;color:#c7d2fe;font-size:13px}
    .row{display:grid;grid-template-columns:1fr;gap:6px}
    @media (min-width:720px){.row{grid-template-columns:repeat(6,1fr);align-items:end}}
    input,select,button{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #26324f;background:#0b1530;color:var(--txt)}
    input:focus,select:focus{outline:none;border-color:#3b82f6;box-shadow:0 0 0 3px rgba(59,130,246,.25)}
    .btn{cursor:pointer;font-weight:700}
    .btn-acc{background:linear-gradient(180deg,#22d3ee,#0891b2);border:none}
    .btn-ghost{background:transparent;border:1px dashed #334155;color:#94a3b8}
    .btn-danger{background:linear-gradient(180deg,#ef4444,#b91c1c);border:none}
    .flex{display:flex;gap:10px;flex-wrap:wrap}
    .pill{padding:6px 10px;border-radius:999px;background:#0b1530;border:1px solid #26324f;font-size:12px;color:#cbd5e1}
    .muted{color:var(--muted);font-size:13px}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{padding:10px 8px;border-bottom:1px solid #1e293b;text-align:left}
    th{font-size:12px;color:#a5b4fc;text-transform:uppercase;letter-spacing:.06em}
    tfoot td{font-weight:800;border-top:2px solid #334155}
    .right{text-align:right}
    .center{text-align:center}
    .badge{display:inline-block;padding:3px 8px;border-radius:8px;background:#0b1530;border:1px solid #334155;font-size:12px}
    .hint{font-size:12px;color:#93c5fd}
    .row-compact{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    .danger{color:#fecaca}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>üßä Ch·∫•m c√¥ng ‚Äì C·∫•p ƒë√¥ng c√°</h1>
    <div class="card">
      <div class="grid" style="gap:12px">
        <div class="row">
          <div>
            <label for="date">Ng√†y</label>
            <input id="date" type="date" />
          </div>
          <div>
            <label for="start">Gi·ªù v√†o</label>
            <input id="start" type="time" step="300" />
          </div>
          <div>
            <label for="end">Gi·ªù ra</label>
            <input id="end" type="time" step="300" />
          </div>
          <div>
            <label for="breakMin">Ngh·ªâ (ph√∫t)</label>
            <input id="breakMin" type="number" inputmode="numeric" min="0" value="0" />
          </div>
          <div>
            <label for="rate">L∆∞∆°ng/gi·ªù (VND)</label>
            <input id="rate" type="number" inputmode="numeric" min="0" value="35000" />
          </div>
          <div>
            <label for="allow">Ph·ª• c·∫•p/ca (VND)</label>
            <input id="allow" type="number" inputmode="numeric" min="0" value="21000" />
          </div>
        </div>
        <div class="toolbar">
          <button class="btn btn-acc" id="addBtn">‚ûï Th√™m ng√†y</button>
          <button class="btn btn-ghost" id="presetBtn">‚è±Ô∏è Ca chu·∫©n 06:30‚Äì17:00</button>
          <button class="btn btn-ghost" id="exportBtn">üì§ Xu·∫•t CSV</button>
          <button class="btn btn-danger" id="clearBtn">üóëÔ∏è Xo√° t·∫•t c·∫£</button>
          <span class="pill">35k/gi·ªù + ph·ª• c·∫•p 21k/ca ‚Ä¢ C√≥ th·ªÉ ra s·ªõm</span>
        </div>
        <div class="hint">M·∫πo: N·∫øu ra s·ªõm, ch·ªâ c·∫ßn s·ª≠a <b>Gi·ªù ra</b>. C√¥ng th·ª©c: <code>Gi·ªù l√†m = (Gi·ªù ra ‚àí Gi·ªù v√†o) ‚àí Ngh·ªâ</code>. Ti·ªÅn = Gi·ªù l√†m √ó L∆∞∆°ng/gi·ªù + Ph·ª• c·∫•p.</div>
        <div style="overflow:auto">
          <table id="tbl">
            <thead>
              <tr>
                <th>Ng√†y</th>
                <th>V√†o</th>
                <th>Ra</th>
                <th class="right">Ngh·ªâ (ph√∫t)</th>
                <th class="right">Gi·ªù l√†m</th>
                <th class="right">Ti·ªÅn l∆∞∆°ng</th>
                <th class="right">Ph·ª• c·∫•p</th>
                <th class="right">T·ªïng</th>
                <th class="center">Xo√°</th>
              </tr>
            </thead>
            <tbody></tbody>
            <tfoot>
              <tr>
                <td colspan="4">T·ªïng th√°ng</td>
                <td class="right" id="totHours">0</td>
                <td class="right" id="totWage">0‚Ç´</td>
                <td class="right" id="totAllow">0‚Ç´</td>
                <td class="right" id="totAll">0‚Ç´</td>
                <td></td>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>
    </div><p class="muted" style="margin-top:10px">D·ªØ li·ªáu l∆∞u trong m√°y (LocalStorage). D√πng t·ªët tr√™n ƒëi·ªán tho·∫°i.</p>

  </div>  <script>
    const $ = sel => document.querySelector(sel);
    const fmtVND = n => new Intl.NumberFormat('vi-VN',{style:'currency',currency:'VND',maximumFractionDigits:0}).format(Math.round(n||0));

    // Elements
    const dateEl = $('#date');
    const startEl = $('#start');
    const endEl = $('#end');
    const breakEl = $('#breakMin');
    const rateEl = $('#rate');
    const allowEl = $('#allow');
    const addBtn = $('#addBtn');
    const presetBtn = $('#presetBtn');
    const exportBtn = $('#exportBtn');
    const clearBtn = $('#clearBtn');
    const tbody = document.querySelector('#tbl tbody');
    const totHoursEl = $('#totHours');
    const totWageEl = $('#totWage');
    const totAllowEl = $('#totAllow');
    const totAllEl = $('#totAll');

    // Defaults
    const todayISO = () => new Date().toISOString().slice(0,10);
    function setDefaults(){
      dateEl.value = dateEl.value || todayISO();
      startEl.value = startEl.value || '06:30';
      endEl.value = endEl.value || '17:00';
    }
    setDefaults();

    // Storage helpers
    const KEY='fish-freeze-timesheet-v1';
    function load(){
      try{ return JSON.parse(localStorage.getItem(KEY))||[] }catch{ return [] }
    }
    function save(list){ localStorage.setItem(KEY, JSON.stringify(list)); }

    // Time math
    function toMin(hhmm){
      if(!hhmm) return 0;
      const [h,m] = hhmm.split(':').map(Number);
      return h*60 + (m||0);
    }
    function hoursBetween(start, end){
      let s = toMin(start), e = toMin(end);
      // N·∫øu ra s·ªõm h∆°n v√†o (qua ng√†y h√¥m sau) th√¨ +24h
      if(e < s) e += 24*60;
      return (e - s) / 60;
    }

    function computeRow({date,start,end,breakMin,rate,allow}){
      const worked = Math.max(0, hoursBetween(start,end) - (Number(breakMin||0)/60));
      const wage = worked * Number(rate||0);
      const total = wage + Number(allow||0);
      return {worked,wage,total};
    }

    function render(){
      const list = load();
      tbody.innerHTML='';
      let sumH=0,sumW=0,sumA=0,sumT=0;
      list.forEach((row,idx)=>{
        const {worked,wage,total} = computeRow(row);
        sumH += worked; sumW += wage; sumA += Number(row.allow||0); sumT += total;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${row.date}</td>
          <td>${row.start}</td>
          <td>${row.end}</td>
          <td class="right">${Number(row.breakMin||0)}</td>
          <td class="right">${worked.toFixed(2)}</td>
          <td class="right">${fmtVND(wage)}</td>
          <td class="right">${fmtVND(row.allow)}</td>
          <td class="right">${fmtVND(total)}</td>
          <td class="center"><button class="btn btn-danger" data-del="${idx}">Xo√°</button></td>
        `;
        tbody.appendChild(tr);
      });
      totHoursEl.textContent = sumH.toFixed(2);
      totWageEl.textContent = fmtVND(sumW);
      totAllowEl.textContent = fmtVND(sumA);
      totAllEl.textContent = fmtVND(sumT);
    }

    function addRow(){
      const date = dateEl.value || todayISO();
      const start = startEl.value || '06:30';
      const end = endEl.value || '17:00';
      const breakMin = Number(breakEl.value||0);
      const rate = Number(rateEl.value||0);
      const allow = Number(allowEl.value||0);
      const row = {date,start,end,breakMin,rate,allow};
      const list = load();
      list.push(row); save(list); render();
    }

    function delRow(i){ const list=load(); list.splice(i,1); save(list); render(); }

    function exportCSV(){
      const list = load();
      const header = ['Ngay','Gio_vao','Gio_ra','Nghi_phut','Gio_lam','Luong_gio','Phu_cap','Tien_luong','Tong'];
      const lines = [header.join(',')];
      list.forEach(r=>{
        const c = computeRow(r);
        lines.push([
          r.date, r.start, r.end, r.breakMin, c.worked.toFixed(2), r.rate, r.allow, Math.round(c.wage), Math.round(c.total)
        ].join(','));
      });
      const blob = new Blob(["\uFEFF"+lines.join('\n')],{type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'cham_cong_cap_dong_ca.csv'; a.click();
      URL.revokeObjectURL(url);
    }

    // Events
    addBtn.addEventListener('click', addRow);
    presetBtn.addEventListener('click', ()=>{ startEl.value='06:30'; endEl.value='17:00'; });
    exportBtn.addEventListener('click', exportCSV);
    clearBtn.addEventListener('click', ()=>{
      if(confirm('Xo√° t·∫•t c·∫£ b·∫£n ghi?')){ localStorage.removeItem(KEY); render(); }
    });
    tbody.addEventListener('click', e=>{
      const b = e.target.closest('button[data-del]');
      if(b){ delRow(Number(b.dataset.del)); }
    });

    // First render
    render();
  </script></body>
</html>